___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Soicos Conversion",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAU20lEQVR4nO2deZRU1Z2Av7fUq6qu3hdo6Aa6abpZBGlFRFkURY1GUYcYo2ZzSYImmugkxjFONJM4jtG4xSwuMdHRMRNNHI0kEkcGQRCjoOzK2mwNNA30Xutb5o+Wbl4t3V0NLznm/L5z+hyq6r377rv3u9vv3SoUx3EcBOE4o/69MyD8YyJiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJnqD3d4DZuRcl2oKjGZBbge7L+VvkS/iEoziO4yS/mQgfwNnwNGx7GTr39n6g+aFiFsrE6/ANP/1vmE3hk0aKWPHdi3GWfBslerjvM8ddhTrtX6UHE9LiEiu++/+w/3c+qp0Y2NnVF6Cf9TNUVfMqf8InlJ7JeyLcBEu+PXCpABpew9zwjBf5Ej7h9IjlrPsVRFuyTsBZ/QhWvOO4Zkr45KMC2LaFs/XlQSWgxNqwdy8+rpkSPvl0i9WxCyXSPOhElAMfHLcMCf8Y6ED/K8B+cCIHszp+TWucpQcttnTadJgQ1BxG5KicVqRxerFKQPcNKh8x02RVq8XKVpsdYZvWhIMKFBsqNSGFaUUqJxb6UJWBxYUt22Jn2B2NyVEtynP8A85TVyLBisM2q9ssdoUdOkzQVSgzFGpzVWaUqNTlGdncZg9NkQTLDlls6LDZF3GI2hDQYHhA4YQ8lZmlGkMCgytLgMZwnDeabda3OxyOWagKDAuoTC5QOLtMo8ifOd86gKMO/uIAjjawgl7UFOX7G+OsaLEzHjMyqHDrGB9fq/ZhDFCwfZE4j25L8PQuk33RlLCci9pQlK9W6XytykdBHwUDEHOg5vVO13vzqw0eO6n/PH3YFuOBrQl+32jSZvZ9bH1+hG/UGHy+Uifo6/+eFzVFeWhrgjcOWMT6uF2/Ap8aqvGtMT7OHhLoP9Mfs7Ujzp0fxvhDo0ncUdIek6fBdaPifG+sTlkwNW3FcRzHirVhPncSipO5wvtCOeU2fPU3ZPzctm3u2BDmvi0mA73CBUNUnp/qp9Dft7S/aQhz6/o4h7JYzAJUBeHRyX4uGh7MeEzYsgi94l6YdIuVOXbXlYhz90dxHt6WIGqnr5RMTClQ+dXJfuqL0t/z/kiMb65J8OLefkxNw+XDNR6ZbFAe7Ls8X26McO2qKC3mwPJeHYRXpwc4ocAtlwqg+QtQyk9Ne+K+hMPaiMPmqEM8NUgPgFJ5Zp8X/+GHUe7NQiqA1w7YfGttPOPnMTPB19/v5NoPspcKYEcELn0nyj0fdmV/cgaaInE+vbz7XrOVCmBVm83Zb3WxcF8k5bP1rVFmLokOSiqAF/ZazFwSYV1rNOMxi5oiXPXewKUCaIjAvHditMXcddU72Tjh2p5/HjId/m2fw9gNNlUbHKZucpj0kUP5WofPNdgs7+wVzKmYiV46IeOFP2qLcu/mWMr7FX6Fm0b7eHCSnzvH+ZhSmDrveXa3xcrDqec6jsM310T55Y6+C7lA7+6yM2GhcMeHCf79OMh1MBrnwrcjLD2cufloQKFPIaePKV6LqbLogOV6b0t7lAuWR9kWzjzuGYpDkQ+MPpzYFoYLlkfZ1JYqbsw0+cbqOJGkBhHS4AuVGvedYHDvBD9zy3V0xZ2PzV0OjzW4W3fPQ2ij6jxi1ReyeO0CrtvpkK5hdDnwchu80uYwv8Thvuo8AqfdlflOgOf32MSSxulzylT+e2qAkkDvHOeu8Tb3fhTmjg97L+wAv9tjckqxu/t+YnuEJ3a6Cx+6C/fySh9fGOFjWrFGodF9e83RBEsPWvxmZ4I/NaWed+eHCeoLIlzYx7DYH/M/iLGqLbXi8zW4ZpSPz1Zq1BfohHzdedrVFWdRs8Xj2xP8tbVbxoDqcP9EPzeO6R1qw4k4V74XZ09q+6I6CPNHG1xUrlOXp+FTNeKWyeYOm1f3J3hse4JdSR1UYwyueC/OsjM1Qr7e8l/RYrGpy53/EQF4bUaQEwrc5b+oKcyl78TpPKooX2i0uG1c72tX23lz7N1c1nJqWqmOxgGeaA1x3ZCfoeaP7vPYde2pLfiBiX6XVACqonL7uBBTCtwSvtfqPn9vOMb3NqSWcm0Ilp4R5NmpuXyq3N8jFUBZwMdnKgMsmJHHH0/zU5Y0P7aBm9bE6UwMYkwFXtwd4aV9qcLOLlVZPSeHh+tDzCgN9EgFMDJkcE1VkOWzQ/x0kp9yP7w0LeCSCuDRbSar2lLLcP4ondVzcrhtbA4nFBj4Pn6sZmg6EwsNbh8XYs2cHK4dmdplr253eGSru5LXp6mn79QaKVIBzBmaw/XV7o0x69ptuszeNHs+3R+J8eXVCpHJv0Tb+RTOjl9j26ldJoBWNA3G3sGL0SpmbY9yU20o7XEAkTQjw4T89OOToigsON1P2O7NtE9xV9gvGkwOJ80BanNg0cwAI0L9r3zmDg+yMKBw3vKoa27WEHF4dpfJDTXZrZAdx+GezalzwYuHKjx/apBQP6s8TdW4qTbIl0ZpFBjuxtaZSPDQ1tS0v1ur8+NJuf3mrdBv8NQpBkVGFw9sdTeah7bFubFGJ//ja3YmUnvb8fmZx+zb63zcMDppwn7U4q+nBh/cYtEUBxQdquajVlyB2rwI2tZix1tQNQNCo1FKZ2Plje9J4O5NCa4elSDPSF+AxWnefrM5wTnl6beClecky9F7nG3bPLfL3dI0HJ4+JTggqY5wcnGAn0xyuOZ9d8/37G6TG2oGnAwAK1virE4aAquC8Osp/Ut1NMlSASxs+rhOjmJWscqPJgz8XgHunmDw9iHLFeY5GIcF+y2uGtn9ujTNYnFxs8W5Q9OnWRzwU9zHNVXoDgQ+v8d9B7avAHv4POzxP4DJj2BPvB+7+gaXVAAH4vDnpsxj59SiVOs/vzLKczsjRM3sVjgbOxLsjLgr8dPlOtNLsytogM+PMJiQmzTsHjY5FM1uOHz9QOoQeGudkTLUD4Y3mlPL545xBobW7/5MFwHdxx1jU/Oz6ECvaFMLU0eRn2yJ8/31nRyOZV6dZ0IF2BE2acy8Cu2Xd/pYCV1ZqVGS1HAPxBW+uCrGmNc7uXplF081RNja0X+FrmlP7a7nDc+ukI/g0zQuHu4ubBMl7ZywL1a3usXSFPhsxbEFnI+wJqknLDHg7LLB3e+cITpFSaeubuvN++QiP2eVuuVKOAp3bzapWtjFpW938sDmMO8eihEbQIegAxyIHdvW96ZY5sooD/p5vN7iCyvjJAfFG6PwzK4Ez+wCiDEqCOcP9fGlkVraXqgxzXK7vmDwe8EmF6SuzfdGsxNrT9I0tDpHoewYHqMcTWNS7zwpX8OXZW91hICuMyFfY/nhXpn2JKX/eL3BOcsiKSvJDkvhlf0mr+zvfl2ow9llGldU6swdpqd9BKcCGOrgIu49mVb7FvMzI3L44+kG1cG+A287I/D4jgQzlka59O12dnW57zCcJuhY4s8+EHmE0jRBn44sgoMAXVZyr3L8vp/SabrrpdA3+HsFKEmaR3WY7rzX5vtZNCvI7JK+76HVhJf2WVz+Xoypi8Msb05d5KkANSENQ+n7GVtf1OX1f8PnluewZk4OD00yOLGP1cYRXtlvM3tpjO2dvXL50sTuI9bg8x1JnR6hZ1l3huq+fuwY8pOMT3FnJnFs7Z+o5U7PUFNvdkyenzdmhXhpmp9zh/TvxfoOh/OWx1iwN+x6XwUoNHRmlaTvYlXzMEqkASXWiOKkH1svGDqw4SjP8HFzbQ5rzsln07k5PHmSn6tH6tSF0tdmQ8ThK+8nOLJ7Ol3vtL1r8KW9PZx67pAse8DSpB6qIWyTsNIYOwjKkvLSED62dBu63OcPyfDYUFM1/qkiyOsz89h5fogXT/Vzc43OtCKFdMUTtuHaVXH2hntX2T023Vyjs+hg94VVqwMOLoCWJdiJ3i0xquJDyauH0kuwQ91h1vOHaEwuHPg2kiPU5RnU5cFXqrtfb+9M8HhD9y6Fo2Nfiw9aLDsYY1ZZgLG5qT3dkoMW55dnffnuc9OsusYOoPd1HZ+r8JcDva/bTHjnsMmssmP/HkBdrsKGo56Bb+pw2N0VZ0Qo+xXn9s44W5Mi6+nKM5nyoMFllXBZZffrw9EELzSa3L0p5lrwNSfgyR0md03odqEn5YsqgnyuQkftXAubb8Y+8AeXVAC2k8Bufw97+7+i7X2SEt3k4ROPfVkNMDrXx48nhXh6Sqqki5q7TTu5UCOYVBbP7krQMYiI+baOGAuTHu9UBBTGhLKbHM8sTT3+59sHF8FPZnqJW06L7sobDE82JEge1GaUZC9/ccDH9TVBlswKpsQoFzX3lqermm4ZtZGK1v/ANtv6vYDeupBrin7OmNzMFfHuoRj3bor0/D22LZzx2CNcVuGnKCnDuz4esgoMnfOSht3GKPxwY5oHaX1gWRb/vC6e8lRg3nAdtZ+FSDLnDdEoSCqCFxpNXm5M/9QiGy4u19CSdHh4a5z1fexQSMfqliiPJsmuApd+HKrZF4676uneTREO9RO7qsnzc2ZSeGLHUav2nlJsi7bw/Kb7OWe8xZSRCkYfMlcUKMyt12iJv83iPa9kPG5zp8PtG2I9fzevjbO9s+8MRywrZVJ9dNF+vTpV5Ae2mfx0y8B2KCQsi5vXRvjjfvdF/ArckCbt/igwfFw3yt0SHODaVVHeaBqYXIejMX6yqYtwwl02dfl+Lkp6QtFhwby/xtjSMbDGtKk9ymV/jZI0veKico1x+d2jjYXiqqfbN8R4dV//PWO7mXli3yPW67tfpMtsR1UV6keqXD5VY1atwrihClXFUFOqcPJIhUvqVc6fpFLwcejg1YbniZjpK3VKUtQ95sDXPojS0kdr+MX2OMmhpNGh3nTOKw9yUVKv5QDfWpfgmvc62BvOnPZH7THmrgjzs4bUQru+2sf4NA9cB8JtdT6GJc1qW0yFi1dE+cHGMO3xzEPjsuYos9+KceuGBHNXRNkfdgtz9wQjZZvNli6HWUsiPLczknGhELdMnt4R4YylMZIHihwV7pnQ2xgqc3xUJYWCvr8xzsa2zD3jioNRlh10X7vmqHpSnG74zrKraIsPbu/7Vyf8C9OGnZX2s5lvtrM8KTJfHVS4tc7H3GE6lTkGtmOztcPkyYY4j2w3Ofp5qAK8f1YO9UW9c7ldnTFmLo2wO819h1SF84dqzCjVKPcr2MDOsMXSgzaLm9NvtT25QOXNmQHykrYqZ7OD9LV9Yea9EyOaJv1SH1w4TGdKoUqZXyVmOWwPO7zeZPJO0jbtupDCC9P8TC7sDRA/vKWLW9all7M2pHBhucbEfI2QrtBlOqxvt1iwz2Jrhv1bj07ycWPSxoE7N3Txo03ua+RpDjfWGFw1Qmdcng9dVWmKxvmfRpM7N8ZpTsrSg5MMbqntLhvFcRynKdzIHSuuZbDMGXEpV9al35r89sEIc5ZFM+6ozNEcbIeMn39xhMZ/Ts1LeX/VoSgXrojRFD+2uNH4XIU/Tw9QlZvaW2W7NfnpHWHmfxDLuE98oFxSrvLy9HzXe7et6+K+Lce+KLi9VueeNDsjDkXjTHszknEzoaF0x706M8TpxuQorDwr2PM9AhWgI956TJltj2U+f3ppkCfqDQIZAm1hS8ko1RklCg9PSr/qnFISYNEsPxNzB1+JZ5WqvDHDn1aqwXB1VQ4vnGpQegxPdC4frvNMmpXxjyeFeHCij4A6uIYUVOGRSb60UgGUBAxemmZQmeF5ftwho1SVfvjDaX7Xl1NUAF0Z3POnI/j6+ZbPF6tCLJwRyBgITSagwq1jdP40PUhxIHOln1AQYPnsIN+t9ZGbxcq5zICHJhq8Nj3I8Cy22wyESypCvHtWgCsr9ZQVXV9UBhR+fZLBb6flUJDhCyS31IVYMivIzOLsVq6zS1TeOiPAN/vYNwdwYlGQpWcEOX/IwAtz7lCNt84McmKhuxwVx3GcrngHtyy7HHuQ39KZV3MNn666ot/juhIJfrvH5LldCd5tsV3LfV2BCXkKF5brXDNKpzYvu15kbzjOf+02WbDfYmWLTdh2V2qhDqcXa1wyTOeKSp0Cf//dSsQ0uXKlezL9qTKFG2oG9gs7G9tiPLfb5C9NFuvbbZJH7VJDYXqxyrzhGp+p8JE7wP1bjuPwZnOM3+2xWNRssq3LcSmsAjUhhTlDNK6q1JlVln3jWbg/wlM7TN44YNGatNYZFVSYM0TnyyM1zsiQds+vzdy/6lY2ta7NOgMAd039OSPyx2R1Ttg02RN26LQdclWF4UEGXLD9EbdM9kYd2hIOiqJQ6oOhARXt7/irOGHTZH+0+wurmuJQZqgMDR7bSHGEtnh32l22Q0hVGBZQyDeOT9qmbbMnYtGWAJ9iM9SvUjKA3Rs9Vz93xLxBiTWh+OSspQLI0XXq8vs/bjAYmk5V373+35wcXWd0/7uJB0WBoVNwfB6ApKCrKlWh7Hds9JxRP+R0ThkyK6uTA1oOV9Ren/VFhX98XCp+edwtjC+sH9CJAS2Hr0/6PsNzR3mSMeGTTepPRZoxXtv5Aq/v/j0xK33kdVzRZK6s+wYVIpWQgbQ/bgvQEWvlg+YVNLR/RKfZiq4YlIdGcmLJVKoLxqU7RRB6yCiWIBwL8h8ICJ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJniBiCZ4gYgmeIGIJnvD/os9T09kWJI4AAAAASUVORK5CYII\u003d"
  },
  "description": "The Soicos Conversion Template sets an attribution model and fires a pixel to Soicos servers if the conversion belongs to Soicos, and a purchase or lead is generated.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "pid",
    "displayName": "Soicos pid",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY",
        "errorMessage": "This field is required."
      }
    ],
    "help": "(Madatory) If the Program ID (pid) is not available, please contact the Soicos operations team to request it."
  },
  {
    "type": "GROUP",
    "name": "pixel configuration",
    "displayName": "Attribution Model",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "model",
        "displayName": "Model",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "non_direct",
            "displayValue": "Last click non direct"
          },
          {
            "value": "last_click_paid",
            "displayValue": "Last click GA4 (Paid and organic channels)"
          },
          {
            "value": "last_click",
            "displayValue": "Last click"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "domain",
        "displayName": "Domain",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "(Mandatory) Enter the domain of the website where the container is linked. Do not include the \"https\" or \"http\" protocol, subdomains, or path details. Only the root domain, like \"example.com\", should be provided.",
        "valueHint": "example.com"
      },
      {
        "type": "TEXT",
        "name": "utm",
        "displayName": "Utm",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "(Mandatory) This is the UTM parameter name used for cookie setup. The value entered here, such as \"utm_source\", will define the name of the UTM parameter for capturing and storing the incoming campaign data in a cookie for attribution models purposes. Case sensitive.",
        "valueHint": "utm_source",
        "defaultValue": "utm_source"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "domains",
        "displayName": "Domains:",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "List of included domains",
            "name": "domain",
            "type": "TEXT"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "model",
            "paramValue": "last_click",
            "type": "EQUALS"
          }
        ],
        "help": "Include all domains external to the main domain that are within the conversion flow.",
        "newRowButtonText": "add domain"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "program configuration",
    "displayName": "Tracking",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "total",
        "displayName": "Total",
        "simpleValueType": true,
        "canBeEmptyString": true,
        "help": "(Optional) Select the variable that is linked to the purchase total."
      },
      {
        "type": "TEXT",
        "name": "orderID",
        "displayName": "OrderID",
        "simpleValueType": true,
        "canBeEmptyString": true,
        "help": "(Mandatory) Select the variable linked to the Order ID. This should be a unique identifier for each purchase or lead."
      },
      {
        "type": "TEXT",
        "name": "pixel_event",
        "displayName": "Pixel event",
        "simpleValueType": true,
        "help": "(Optional) Enter a value to add as an event parameter in the tracking pixel. This value will be appended to the pixel URL as \"\u0026event\u003d{{entered_value}}\", enabling additional tracking logic.",
        "valueValidators": [],
        "enablingConditions": [
          {
            "paramName": "typ_type",
            "paramValue": "single",
            "type": "EQUALS"
          },
          {
            "paramName": "trigger_type",
            "paramValue": "custom_event",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "currency",
        "displayName": "Currency:",
        "selectItems": [
          {
            "value": "ARS",
            "displayValue": "ARS"
          },
          {
            "value": "BRL",
            "displayValue": "BRL"
          },
          {
            "value": "BOB",
            "displayValue": "BOB"
          },
          {
            "value": "CRC",
            "displayValue": "CRC"
          },
          {
            "value": "COP",
            "displayValue": "COP"
          },
          {
            "value": "CHF",
            "displayValue": "CHF"
          },
          {
            "value": "CLP",
            "displayValue": "CLP"
          },
          {
            "value": "DOP",
            "displayValue": "DOP"
          },
          {
            "value": "EUR",
            "displayValue": "EUR"
          },
          {
            "value": "MXN",
            "displayValue": "MXN"
          },
          {
            "value": "PEN",
            "displayValue": "PEN"
          },
          {
            "value": "PYG",
            "displayValue": "PYG"
          },
          {
            "value": "USD",
            "displayValue": "USD"
          },
          {
            "value": "UYU",
            "displayValue": "UYU"
          }
        ],
        "simpleValueType": true,
        "help": "Select the transaction currency."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "trigger configuration",
    "displayName": "Pixel Trigger",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "trigger_type",
        "displayName": "Trigger type",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "page_view",
            "displayValue": "Page view"
          },
          {
            "value": "custom_event",
            "displayValue": "Custom Event"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "SELECT",
        "name": "typ_type",
        "displayName": "Thank you page type",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "single",
            "displayValue": "Single"
          },
          {
            "value": "multiple",
            "displayValue": "Multiple"
          }
        ],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "trigger_type",
            "paramValue": "page_view",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "typ",
        "displayName": "Page Path",
        "simpleValueType": true,
        "help": "(Mandatory) This is the path to the page used to trigger actions, like a \"thank you\" page. Enter only the path, not the full URL. For example, use \"checkout\" if the page URL is \"example.com/checkout\". Note: this input is case-sensitive and uses a \"contains\" match, so ensure the path entered accurately reflects the target page.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "typ_type",
            "paramValue": "single",
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "custom_event",
        "displayName": "Event name",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "trigger_type",
            "paramValue": "custom_event",
            "type": "EQUALS"
          }
        ],
        "help": "(Mandatory) Datalayer event name.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "valueHint": "purchase"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "typ_information",
        "displayName": "Thank you page Information",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "(Mandatory) Page Path",
            "name": "typ",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "valueHint": "checkout"
          },
          {
            "defaultValue": "",
            "displayName": "(Optional) Pixel Event",
            "name": "event",
            "type": "TEXT",
            "valueValidators": []
          }
        ],
        "enablingConditions": [
          {
            "paramName": "typ_type",
            "paramValue": "multiple",
            "type": "EQUALS"
          }
        ],
        "newRowButtonText": "Add Thank You Page"
      },
      {
        "type": "TEXT",
        "name": "utm_value",
        "displayName": "Cookie utm value",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "(Mandatory) Enter the value to be used for comparison with the cookie\u0027s stored value. Case sensitive.",
        "valueHint": "soicos",
        "defaultValue": "soicos"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "Advanced Setting",
    "displayName": "Logs",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "logs",
        "checkboxText": "Enabled",
        "simpleValueType": true,
        "alwaysInSummary": true,
        "help": "Enable this option to print variable values in the console during Preview Mode, allowing you to debug and monitor values for each variable used in the template."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const getReferrerUrl = require('getReferrerUrl');
const getQueryParameters = require('getQueryParameters');
const getUrl = require('getUrl');
const getCookieValues = require('getCookieValues');
const setCookie = require('setCookie');
const copyFromDataLayer = require('copyFromDataLayer');
const injectScript = require('injectScript');
const logToConsole = require('logToConsole');
const queryPermission = require('queryPermission');

var logs = [];
const domain = data.domain;
var pixel_event = data.pixel_event;
const trigger_cookie_value = data.utm_value;
const utm_source = getQueryParameters(data.utm);
const gclid = getQueryParameters('gclid');
const url = getUrl();

switch(data.model) {
  case "last_click":
    lastClickPixel();
    break;
  case "last_click_paid":
    lastClickPaidPixel();
    break;
  case "non_direct":
    nonDirectPixel();
    break;
}

function lastClickPixel() {
  setUtmSourceCookie(lastLogic);
  callPixel();
}

function nonDirectPixel() {
  setUtmSourceCookie(nonDirectLogic);
  callPixel();
}

function getPixel(url) {
  injectScript(url, data.gtmOnSuccess, data.gtmOnFailure);
}

function callPixel() {
  if(cookieCondition()  && typCondition()) {
    const pixelUrl = "https://ad.soicos.com/conv.php?pid="+data.pid+"&trans[orderID]="+data.orderID+"&trans[total]="+data.total+"&trans[currency]="+data.currency+"&event="+pixel_event;
    getPixel(pixelUrl);
    logs.push({ message: "Pixel called", value: pixelUrl });
    data.gtmOnSuccess();
  }else {
    data.gtmOnFailure();
  }
}

function inCustomEvent () {
  const isCustomEvent = data.trigger_type == "custom_event" && copyFromDataLayer('event') == data.custom_event;
  logs.push({ message: "Custom event check", value: isCustomEvent });
  return isCustomEvent;
}

function extractDomain(url) {
  return (url.indexOf("://") > -1 ? url.split('/')[2] : url.split('/')[0]).split(':')[0];
}

function containsElement (contain, elem) {
  return contain.indexOf(elem) != -1;
}

function containsAnyElement(contains, elem) {
  return contains.some(contain => containsElement(elem, contain));
}

function setUtmSourceCookie(logicFunction) {
  if(!inCustomEvent())
    logicFunction();
}

function lastLogic() {
  const domains = data.domains || [];
  const ref = getReferrerUrl("host");
  domains.push({"domain": domain});
  const domains_included = domains.map((d) => extractDomain(d.domain));
  logs.push({ message: "UTM Source", value: utm_source });
  if (utm_source)
  	setCookieSoicos(utm_source);
  else if (gclid)
  	setCookieSoicos("GoogleAds");
  else if (ref) {
    if (ref != "tagassistant.google.com" && !containsAnyElement(domains_included, ref)){
      logs.push({ message: "Referrer", value: ref });
      setCookieSoicos(ref);
    }
  }
}

function nonDirectLogic() {
  if (utm_source)
  	setCookieSoicos(utm_source);
  else if (gclid)
  	setCookieSoicos("GoogleAds");
}


function setCookieSoicos(value) {
  const options = { "path": '/', "max-age": "2592000", "domain": domain };
  if (queryPermission('set_cookies', 'attr_source_cookie', options))
  	setCookie('attr_source_cookie', value, options);
}

function typCondition() {
  function inUrl(ele){
    return containsElement(url, ele);
  }
  
  function isOnSingleTyp(){
    return data.typ_type == "single" && inUrl(data.typ);
  }
  
  function isOnMultipleTyps () {
    if (data.typ_type != "multiple") return false;
    const typs = data.typ_information || [];
    const info = typs.filter(typ_data => inUrl(typ_data.typ));
    const existsInUrl = info.length != 0;
    if (existsInUrl) pixel_event = info[0].event;
    return existsInUrl;
  }
  
  const typConditionResult = inCustomEvent() || isOnSingleTyp() || isOnMultipleTyps();
  logs.push({ message: "typCondition", value: typConditionResult });
  return typConditionResult;
}

function cookieCondition(){
  const cookieConditionResult = getCookieValues('attr_source_cookie')[0] == trigger_cookie_value;
  logs.push({ message: "Cookie condition", value: cookieConditionResult });
  return cookieConditionResult;
}

function lastClickPaidPixel() {
  setUtmSourceCookie(lastLogic);
  callPixel();
}

function showLogs() {
  logs.forEach(log => logToConsole(log.message, log.value));
}

if(data.logs){
  showLogs();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "attr_source_cookie"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_referrer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "attr_source_cookie"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://ad.soicos.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedKeys",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "event.*"
              },
              {
                "type": 1,
                "string": "_event.*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 9/4/2024, 10:23:42 AM


